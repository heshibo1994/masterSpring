<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="test">
    <select id = "findOrderUser" resultType="com.mybatis.po.OrderCustom">
        select orders.*,user.username,user.sex,user.addr from orders,user where orders.user_id=user.id
    </select>

    <resultMap id="orderUserResultMap" type = "com.mybatis.po.Orders">
        <id column="user_id" property="userId"/>
        <result column="number" property="number"/>
        <result column="createtime" property="createtime"/>
        <result column="note" property="note"/>

        <association property="user" javaType="com.mybatis.po.User">
            <!-- id:关联查询用户的唯一标识
                column：指定唯一标识用户信息的列
                javaType：映射到user的哪个属性
             -->
            <id column="user_id" property="id"/>
            <result column="username" property="username"/>
            <result column="sex" property="sex"/>
            <result column="addr" property="addr"/>
        </association>
    </resultMap>

    <select id = "findOrdersUserResultMap" resultMap="orderUserResultMap">
        select orders.*,user.username,user.sex,user.addr from orders,user where orders.user_id=user.id
    </select>


    <!-- 查询订单及订单明细的resultMap -->
    <resultMap id="ordersAndOrderDetailResultMap" type="com.mybatis.po.Orders"
               extends="orderUserResultMap">
        <!-- 订单明细信息
            collection：对关联查询的到的多条记录映射到集合中
            property：orders中要映射的哪个属性
            ofType：集合属性中pojo的类型
         -->
        <collection property="orderDetails" ofType="com.mybatis.po.OrderDetails">
            <!-- 主键 -->
            <id column="orderdetail_id" property="id"/>
            <!--普通列-->
            <result column="items_id" property="itemsId"/>
            <result column="items_num" property="itemsNum"/>
            <result column="orders_id" property="orderId"/>
        </collection>
    </resultMap>


    <!-- 查询订单关联查询用户及订单明细，使用resultMap  -->
    <select id="findOrdersAndOrderDetailResultMap" resultMap="ordersAndOrderDetailResultMap">
        select orders.*, user.username, user.sex, user.addr,
        orderdetail.id, orderdetail.items_id, orderdetail.items_num, orderdetail.orders_id
        from orders, user, orderdetail
        where orders.user_id=user.id and orders.id=orderdetail.orders_id
    </select>


    <!-- 查询用户及用户所购买的商品信息 -->
    <resultMap id="usersAndItemsResultMap" type="com.mybatis.po.User">
        <!-- 用户信息 -->
        <id column="user_id" property="userId"/>
        <result column="username" property="username"/>
        <result column="sex" property="sex"/>
        <result column="addr" property="addr"/>
        <!-- 一个用户对应多个订单信息 -->
        <collection property="orders" ofType="com.mybatis.po.Orders">
            <id column="id" property="id"/>
            <result column="user_id" property="userId"/>
            <result column="number" property="number"/>
            <result column="createtime" property="createtime"/>
            <result column="note" property="note"/>
            <!-- 一个订单对应多个订单明细信息 -->
            <collection property="orderDetails" ofType="com.mybatis.po.OrderDetails">
                <!-- 主键 -->
                <id column="orderdetail_id" property="id"/>
                <!--普通列-->
                <result column="items_id" property="itemsId"/>
                <result column="items_num" property="itemsNum"/>
                <result column="orders_id" property="orderId"/>
                <!-- 一个订单明细对应一条商品信息 -->
                <association property="items" javaType="com.mybatis.po.Items">
                    <id column="items_id" property="id"/>
                    <result column="items_name" property="name"/>
                    <result column="items_detail" property="detail"/>
                    <result column="items_price" property="price"/>
                </association>
            </collection>
        </collection>
    </resultMap>


    <!-- 查询用户及用户购买的商品信息，使用resultMap  -->
    <select id="findUsersAndItemsResultMap" resultMap="usersAndItemsResultMap">
        select
        orders.*,
        user.username,
        user.sex,
        user.addr,
        orderdetail.id orderdetail_id,
        orderdetail.items_id,
        orderdetail.items_num,
        orderdetail.orders_id,
        items.name items_name,
        items.detail items_detail,
        items.price items_price
        from
        orders,
        user,
        orderdetail,
        items
        where
        orders.user_id=user.id
        and
        orders.id=orderdetail.orders_id
        and
        orderdetail.items_id=items.id
    </select>
</mapper>


